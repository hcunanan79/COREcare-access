{% extends "base.html" %}

{% block title %}{{ client.first_name }}'s Calendar{% endblock %}

{% block content %}
<div class="main-content">

    <!-- Breadcrumb -->
    <a href="{% url 'family_home' %}" class="back-link">
        &larr; Back to My Clients
    </a>

    <div class="client-header">
        <div>
            <h1>{{ client.first_name }} {{ client.last_name }}</h1>
            <p class="client-header-subtitle">ðŸ“… Calendar & Schedule</p>
        </div>
        {% if can_add_events %}
        <a href="{% url 'create_event' client_id=client.id %}" class="btn btn-primary">
            <i class="fas fa-plus"></i> Add Event
        </a>
        {% endif %}
    </div>

    <!-- Messages -->
    {% if messages %}
    <div class="message-container" style="margin-bottom: 1rem;">
        {% for message in messages %}
        <div class="alert alert-{{ message.tags }}">
            {{ message }}
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- Date Navigation -->
    <div class="calendar-nav">
        <form method="get" class="calendar-nav-form">
            <label>
                From:
                <input type="date" name="start_date" value="{{ start_date|date:'Y-m-d' }}" class="form-input">
            </label>
            <label>
                To:
                <input type="date" name="end_date" value="{{ end_date|date:'Y-m-d' }}" class="form-input">
            </label>
            <button type="submit" class="btn btn-secondary">Update</button>
        </form>
    </div>

    <!-- Calendar Legend -->
    <div class="calendar-legend">
        <span class="legend-item">
            <span class="legend-color schedule-item-shift"></span>
            ðŸ‘¤ Caregiver Shifts
        </span>
        <span class="legend-item">
            <span class="legend-color schedule-item-event"></span>
            ðŸ“Œ Family Events
        </span>
    </div>

    <!-- List View (Mobile-First) -->
    <div class="calendar-list-view">
        {% if schedule_by_date %}
            {% for date, items in schedule_by_date %}
            <div class="calendar-day-group">
                <div class="calendar-day-header">
                    <span class="calendar-day-name">{{ date|date:"l" }}</span>
                    <span class="calendar-day-date">{{ date|date:"M d, Y" }}</span>
                    {% if date == today %}
                    <span class="calendar-today-badge">Today</span>
                    {% endif %}
                </div>
                
                {% for item in items %}
                <div class="schedule-item {{ item.color_class }}">
                    <div class="schedule-item-icon">{{ item.icon }}</div>
                    <div class="schedule-item-content">
                        <div class="schedule-item-title">{{ item.title }}</div>
                        <div class="schedule-item-time">
                            {{ item.start_time|date:"g:i A" }} - {{ item.end_time|date:"g:i A" }}
                        </div>
                        {% if item.location %}
                        <div class="schedule-item-location">
                            <i class="fas fa-map-marker-alt"></i> {{ item.location }}
                        </div>
                        {% endif %}
                        {% if item.details.description %}
                        <div class="schedule-item-description">
                            {{ item.details.description|truncatewords:20 }}
                        </div>
                        {% endif %}
                        {% if item.details.created_by %}
                        <div class="schedule-item-meta">
                            Added by {{ item.details.created_by }}
                        </div>
                        {% endif %}
                    </div>
                    {% if item.type == 'event' and can_add_events %}
                    <div class="schedule-item-actions">
                        <a href="{% url 'edit_event' client_id=client.id event_id=item.id %}" 
                           class="btn btn-small btn-secondary" title="Edit">
                            <i class="fas fa-edit"></i>
                        </a>
                        <a href="{% url 'delete_event' client_id=client.id event_id=item.id %}" 
                           class="btn btn-small btn-danger" title="Delete">
                            <i class="fas fa-trash"></i>
                        </a>
                    </div>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
            {% endfor %}
        {% else %}
            <div class="empty-state">
                <div class="empty-state-icon">ðŸ“…</div>
                <h3>No Events Scheduled</h3>
                <p>There are no shifts or events scheduled for this time period.</p>
                {% if can_add_events %}
                <a href="{% url 'create_event' client_id=client.id %}" class="btn btn-primary">
                    Add Your First Event
                </a>
                {% endif %}
            </div>
        {% endif %}
    </div>

</div>

<style>
/* Calendar-specific styles */
.calendar-nav {
    margin-bottom: 1.5rem;
}

.calendar-nav-form {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    align-items: flex-end;
}

.calendar-nav-form label {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
    font-size: 0.875rem;
    color: var(--text-secondary, #6b7280);
}

.calendar-nav-form .form-input {
    padding: 0.5rem;
    border: 1px solid var(--border-color, #e5e7eb);
    border-radius: 6px;
}

.calendar-legend {
    display: flex;
    flex-wrap: wrap;
    gap: 1.5rem;
    margin-bottom: 1.5rem;
    padding: 0.75rem 1rem;
    background: var(--bg-secondary, #f9fafb);
    border-radius: 8px;
}

.legend-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.875rem;
}

.legend-color {
    width: 12px;
    height: 12px;
    border-radius: 3px;
}

.calendar-day-group {
    margin-bottom: 1.5rem;
}

.calendar-day-header {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.75rem 0;
    border-bottom: 2px solid var(--primary-color, #3b82f6);
    margin-bottom: 0.75rem;
}

.calendar-day-name {
    font-weight: 600;
    color: var(--text-primary, #1f2937);
}

.calendar-day-date {
    color: var(--text-secondary, #6b7280);
    font-size: 0.875rem;
}

.calendar-today-badge {
    background: var(--primary-color, #3b82f6);
    color: white;
    padding: 0.125rem 0.5rem;
    border-radius: 4px;
    font-size: 0.75rem;
    font-weight: 600;
}

.schedule-item {
    display: flex;
    align-items: flex-start;
    gap: 1rem;
    padding: 1rem;
    background: white;
    border-radius: 8px;
    margin-bottom: 0.5rem;
    border-left: 4px solid transparent;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    transition: transform 0.15s ease;
}

.schedule-item:hover {
    transform: translateX(4px);
}

.schedule-item-shift {
    border-left-color: #3b82f6;
    background: linear-gradient(135deg, #eff6ff 0%, white 100%);
}

.schedule-item-event {
    border-left-color: #10b981;
    background: linear-gradient(135deg, #ecfdf5 0%, white 100%);
}

.schedule-item-medical {
    border-left-color: #ef4444;
    background: linear-gradient(135deg, #fef2f2 0%, white 100%);
}

.schedule-item-therapy {
    border-left-color: #8b5cf6;
    background: linear-gradient(135deg, #f5f3ff 0%, white 100%);
}

.schedule-item-icon {
    font-size: 1.5rem;
    flex-shrink: 0;
}

.schedule-item-content {
    flex: 1;
    min-width: 0;
}

.schedule-item-title {
    font-weight: 600;
    color: var(--text-primary, #1f2937);
    margin-bottom: 0.25rem;
}

.schedule-item-time {
    font-size: 0.875rem;
    color: var(--text-secondary, #6b7280);
}

.schedule-item-location {
    font-size: 0.875rem;
    color: var(--text-secondary, #6b7280);
    margin-top: 0.25rem;
}

.schedule-item-description {
    font-size: 0.875rem;
    color: var(--text-secondary, #6b7280);
    margin-top: 0.5rem;
    font-style: italic;
}

.schedule-item-meta {
    font-size: 0.75rem;
    color: var(--text-muted, #9ca3af);
    margin-top: 0.5rem;
}

.schedule-item-actions {
    display: flex;
    gap: 0.5rem;
    flex-shrink: 0;
}

.btn-small {
    padding: 0.375rem 0.625rem;
    font-size: 0.875rem;
}

.btn-danger {
    background: #ef4444;
    color: white;
}

.btn-danger:hover {
    background: #dc2626;
}

.empty-state {
    text-align: center;
    padding: 3rem 1.5rem;
    background: var(--bg-secondary, #f9fafb);
    border-radius: 12px;
}

.empty-state-icon {
    font-size: 3rem;
    margin-bottom: 1rem;
}

.empty-state h3 {
    margin-bottom: 0.5rem;
    color: var(--text-primary, #1f2937);
}

.empty-state p {
    color: var(--text-secondary, #6b7280);
    margin-bottom: 1.5rem;
}

.alert {
    padding: 0.75rem 1rem;
    border-radius: 6px;
    margin-bottom: 0.5rem;
}

.alert-success {
    background: #ecfdf5;
    color: #047857;
    border: 1px solid #a7f3d0;
}

.alert-error {
    background: #fef2f2;
    color: #b91c1c;
    border: 1px solid #fecaca;
}

/* Responsive */
@media (max-width: 640px) {
    .calendar-nav-form {
        flex-direction: column;
    }
    
    .calendar-nav-form label {
        width: 100%;
    }
    
    .calendar-nav-form .form-input {
        width: 100%;
    }
    
    .schedule-item {
        flex-wrap: wrap;
    }
    
    .schedule-item-actions {
        width: 100%;
        margin-top: 0.75rem;
        padding-top: 0.75rem;
        border-top: 1px solid var(--border-color, #e5e7eb);
        justify-content: flex-end;
    }
}
</style>
{% endblock %}
